% a new empty document
\documentclass[12pt]{article}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{semantic}

\usepackage{hyperref}
\usepackage{cleveref}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{float}
\usepackage{listings}
\usepackage{color}
\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{pgfplotstable}
\usepackage{booktabs}
\usepackage{bookmark}
\usepackage{array}
\usepackage{multirow}
% \usepackage{minted}
% \usepackage{xfrac,unicode-math}
\def\lock {\mathbb{L}}

\title {Typing Rules and Evaluation rules}
\author{L}


\begin{document}
% \fontname\font
\maketitle

\section{Syntax}
\begin{flalign*}
    t :: =\qquad& &\emph{\texttt{terms}}\\
    & v \\
    & if\ term\ then\ term\ else\ term \\
    & succ\ number\\
    & pred\ number\\
    & iszero\ number\\
    & refterm \\
    & t\ t \\
    & wait\ t \\
    & fork\{t\} \\
    & mutex<X1,X2,...,Xn> \\
    & abstraction \\
    & tagterm\\
    & recordsterm \\
    abstraction :: = \qquad & & \emph{\texttt{abstraction term}} \\
    & \lambda x:T.t \\
    & \lambda<X_1,X_2,...,X_n> x:T.t \\
    & \lambda<X_1,X_2,...,X_n>[Y] x:T.t \\
\end{flalign*}
\begin{flalign*}
    refterm :: = \qquad & & \emph{\texttt{terms about ref}} \\
    & !t \\
    & ref\ t \\
    & ref<X1,X2,...,Xn>\ t \\
    & t := t \\
    thterm :: = \qquad & & \emph{\texttt{terms about thread}}\\
    & wait\ t \\
    & fork \{t\} \\
    tagterm :: = \qquad & & \emph{\texttt{terms about tags}}\\
    & <l=t>\ as\ T\\
    & case\ t\ of \ <l_i = x_i> \implies t_i^{i\in1..n}\\
    recodesterm :: = \qquad & & \emph{\texttt{terms about recoders}} \\
    & {l_i = t_i^{i\in1..n}} \\
    & t.l \\
    v = \qquad& &\emph{\texttt{values}}\\
    & true \\
    & false \\
    & 0 \\
    & \lambda x:T.t \\
    & string \\
    & unit \\
    & number \\
    & float \\
    & record \\
    & mutex \\
    & loc \\
    & tag \\
    & fork v\\
    & <l=v>\ as\ T\\
    & {l_i = v_i^{i\in1..n}}
\\
\end{flalign*}

\section{Typing rules}
\subsection{Fork}

\begin{align*}
    \tag {\textsc{T-Fork}}
    \inference[]{\Gamma |\lock\vdash t:~T}{ fork \{~t~\} :~Thread~T} 
    \\
    \\
    \tag {\textsc{T-Wait}}
    \inference[]{\Gamma|\lock\vdash t:~Thread~T}{ wait ~t~ :~T}
\end{align*}

\subsection{Mutex}
\begin{align*}
    \tag {\textsc{T-Mutex}}
    \inference[]{
        %X\notin \Gamma  
        }{\Gamma|\lock \vdash mutex<X> :~Mutex~X}
\end{align*}

\subsection{Acquire}
\begin{align*}
\tag{\textsc{T-Acquire}}
\inference[]{max\{\lock\}<_{lex}X & \Gamma|\lock \vdash t_1:Mutex~X 
& \Gamma|(\lock,X) \vdash t_2:T}{\Gamma|\lock \vdash Aacquire~t_1~t_2:T}
\end{align*}

\subsection{Abstraction}
\begin{align*}
\tag {\textsc{T-Abs}}
\inference[]{
    (\Gamma,x:T_1)|(\lock\cup\{X_i\}^{i\in 1...n}) \vdash t:T_2 & mam(\Gamma,T1) = Y
    }{\Gamma|\lock \vdash \lambda<X_i^{i\in 1...n}> x:T_1.t :~T_1<X_i^{i\in 1...n}>[Y]\rightarrow T_2}
    \\
    \\
    \tag {\textsc{T-App}}
\inference[]{
    \Gamma|\lock \vdash T_1.t :~T_1<X_i^{i\in 1...n}>[Y]\rightarrow T_2 & \Gamma|\lock \vdash t_2:T_2 
    }{\Gamma|\lock \vdash t_1\ t_2:~T_2}
\end{align*}

\subsection{Ref}
\begin{align*}
    \tag {\textsc{T-Ref}}
    \inference[]{\Gamma|\lock \vdash v:T}{\Gamma|\lock \vdash ref<X_i^{i\in 1...n}> v:~Ref<X_i^{i\in 1...n}>T}
    \\
    \\
    \tag {\textsc{T-Deref}}
    \inference[]{\Gamma|\lock \vdash t_1:Source<X_i^{i\in 1...n}>T & X_i\in \lock^{i\in 1...n}}{\Gamma|\lock\vdash !t_1:T}
    \\
    \\
    \tag {\textsc{T-Assign}}
    \inference[]{\Gamma|\lock \vdash t_1:Sink<X_i^{i\in 1...n}>T & \Gamma|\lock \vdash t_2:T & X_i\in \lock^{i\in 1...n}}{\Gamma|\lock\vdash t_1 := t_2:Unit}
\end{align*}

\section{Subtyping rules}

\subsection{Thread}
\begin{align*}
    \tag {\textsc{S-Thread}}
    \inference[]{T_1 <: T_2}{ Thread~T_1~<:~Thread~T_2}
\end{align*}

\subsection{Abstraction}
\begin{align*}
\tag {\textsc{S-Arrow}}
\inference[]{
    T_1~<:~S_1 & S_2~<:~T_2 & Y_1 \ge_{lex} Y_2 &\{X_i\}^{i\in 1...n} \subseteq   \{Z_j\}^{j\in 1...m}
    }{~S_1<X_i^{i\in 1...n}>[Y_1]\rightarrow S_2~<:~T_1<Z_j^{j\in 1...m}>[Y_2]\rightarrow T_2}
    \\
    \\
\\
\end{align*}

\subsection{Ref}
\begin{align*}
    \tag{\textsc{S-Source}}
    \inference[]{T_1 <: T_2 & \{X_i\}^{i\in 1...n} \subseteq   \{Z_j\}^{j\in 1...m}}{Source<X_i^{i\in 1...n}>T_1 <: Source<Z_j^{j\in 1...m}>T_2}
    \\
    \\
    \tag{\textsc{S-Sink}}
    \inference[]{T_2 <: T_1 & \{X_i\}^{i\in 1...n} \subseteq   \{Z_j\}^{j\in 1...m}}{Sink<X_i^{i\in 1...n}>T_1 <: Sink<X_j^{j\in 1...m}>T_2}
    \\
    \\
    \tag{\textsc{S-RefSource}}
    \inference[]{T_1<:T_2 & \{X_i\}^{i\in 1...n} \subseteq   \{Z_j\}^{j\in 1...m}}{
    Ref<X_i^{i\in 1...n}>T_1 <: Source<X_i^{i\in 1...n}>T_1}
    \\
    \\
    \tag{\textsc{S-RefSink}}
    \inference[]{T_2<:T_1 & \{X_i\}^{i\in 1...n} \subseteq   \{Z_j\}^{j\in 1...m}}
    {Ref<X_i^{i\in 1...n}>T_1 <: Sink<X_i^{i\in 1...n}>T_1}
    \\
    \\
\end{align*}
\subsection{Thread}
\begin{align*}
    \tag {\textsc{S-Thread}}
    \inference[]{T_1 <: T_2}{ Thread~T_1~<:~Thread~T_2}
\end{align*}

\section{Algorithmic Typing Rules}


\section{Evaluation Rules}

\subsection{Threads}
\begin{align*}
    \tag{\textsc{E-Thread}}
    \inference[]{threads = \{t_i\}^{i\in 1...n} & <t_{id},\mu,Th,L> -> <t_{id}',\mu',Th',L'> & id' = next(id,threads')}{[Th,\mu,id,L]->[Th',\mu',id',L']}
    \\
    \\
\end{align*}
\subsection{Wait}
\begin{align*}
    \tag {\textsc{E-Wait}}
    \inference{threads(p) = v}{<wait~p,\mu,Th,L> -> <v,\mu,Th\backslash\{p\},L>}
    \\
    \\
    \tag {\textsc{E-Fork}}
    {<fork\ t,\mu,Th, L>-> <p ,\mu, Th, L>}
\end{align*}

\subsection{Mutex}
\begin{align*}
    \tag {\textsc{E-RefMutex}}
    \inference[]{t_1->t_1'}{ref<x> t_1 -> ref<x> t_1'}
    \\
    \\
    \tag {\textsc{E-RefMutex}}
    \inference[]{t_1|\mu->t_1'|\mu '}{ref<x>~t_1|\mu -> ref<x>~t_1|\mu}
    \\
    \\
    \tag {\textsc{E-RefV}}
    \inference[]{l\notin dom(\mu)}{ref<x>~v|\mu -> l|\mu,l\mapsto v}
    \\
    \\
    \tag {\textsc{E-Deref}}
    \inference[]{t_1|\mu->t_1'|\mu '}{!t_1|\mu -> !t_1'|\mu}
    \\
    \\
    \tag {\textsc{E-DerefLoc}}
    \inference[]{\mu(l)=v}{!l|\mu -> v|\mu}
    \\
    \\
    \tag {\textsc{E-Assign1}}
    \inference[]{t_1|\mu->t_1'|\mu '}{t_1:=t_2|\mu -> t_1':=t_2|\mu}
    \\
    \\
    \tag {\textsc{E-Assign2}}
    \inference[]{t_2|\mu->t_2'|\mu '}{v:=t_2|\mu -> v:=t_2'|\mu}
    \\
    \\
    \tag {\textsc{E-AssignV}}
    \inference[]{\mu(l)=v}{l:=v|\mu -> unit|\mu,l\mapsto v}
    \\
    \\
    \tag {\textsc{S-RefMutex}}
    \inference[]{\Gamma|\lock \vdash t_1:Ref<X>T & \Gamma \vdash t_2:T & X\in \lock}{\Gamma|\lock\vdash t_1 := t_2:Unit}
\end{align*}
\begin{align*}
    \tag{\textsc{E-Lock1}}
    \inference[]{t_1->t_1'}{lock~t_1~t_2 -> lock~t_1'~t_2}
    \\
    \\
    \tag{\textsc{E-Lock2}}
    \inference[]{t_2->t_2'}{lock~v_1~t_2 -> lock~v_1~t_2'}
    \\
    \\
    \tag{\textsc{E-LockV}}lock~v_1~v_2 -> v_2
    \end{align*}
    
\end{document}
    
    